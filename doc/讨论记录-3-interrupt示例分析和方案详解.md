# 讨论记录 #3 - interrupt 示例分析和方案详解

> 时间：2026-01-09
> 主题：分析官方 interrupt 示例、详解"上一个正方形"方案、MVP 概念说明

---

## 一、MVP 是什么意思？

**MVP = Minimum Viable Product（最小可行产品）**

不是"最有价值球员"😄，而是软件开发中的一个概念：

### 定义：
用最少的功能和最简单的实现，快速验证核心想法是否可行。

### 在我们项目中的应用：
- **MVP 阶段**：先实现最基础的功能，能跑通流程就行
  - 例如："上一个正方形"用最简单的方式（查询数据库最新创建的）
  - 不考虑复杂的对话语境
  - 不考虑错误处理

- **优化阶段**：在 MVP 能跑通后，再升级到更智能的方案
  - 例如：升级到"引用栈"方案，支持对话语境

### 为什么要分阶段？
1. **快速验证**：先确认技术方案可行
2. **降低风险**：避免一开始就做复杂设计，结果发现方向错了
3. **迭代优化**：基于实际使用体验再改进

---

## 二、关于"上一个正方形"的三个方案（详细说明）

### 背景场景：
```
用户对话：
1. "画一个正方形，边长5"    → 创建 square_001 (10:00)
2. "画一个圆形，半径3"       → 创建 circle_001 (10:01)
3. "再画一个正方形，边长8"   → 创建 square_002 (10:02)
4. "修改上一个正方形的边长为10"

问题：第4句中的"上一个正方形"指的是哪个？
```

---

### 方案 A：基于创建时间（最简单）

#### 实现方式：
```sql
-- 查询最近创建的正方形
SELECT * FROM shapes
WHERE type = 'square'
ORDER BY created_at DESC
LIMIT 1;

-- 结果：square_002（10:02 创建的）
```

#### 优点：
- **实现简单**：一条 SQL 查询就搞定
- **不需要额外存储**：只依赖数据库的 created_at 字段
- **性能好**：有索引的话查询很快

#### 缺点：
- **不符合对话语境**：如果用户在第3步和第4步之间说了很多其他话，"上一个"的含义可能不是"最近创建的"

#### 适用场景：
- MVP 阶段
- 用户操作比较线性（创建 → 修改 → 创建 → 修改...）
- 对话中不会频繁切换话题

---

### 方案 B：基于会话引用栈（推荐）

#### 核心思想：
在对话过程中，维护一个"最近提到的对象"列表。

#### 数据结构：
```typescript
// 存储在 LangGraph State 中
interface AgentState {
  messages: Message[];

  // 引用栈
  referencedObjects: Array<{
    type: 'square' | 'circle' | 'triangle';
    id: string;
    mentionedAt: number;  // 第几轮对话提到的
  }>;
}
```

#### 实现逻辑：
