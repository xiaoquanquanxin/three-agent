# 待确认问题清单

> 最后更新：2026-01-09
> 状态：等待用户确认

---

## 一、核心疑问（需要优先确认）

### 问题 1：Three.js 渲染方式 ⚠️（最关键）

**背景：**
用户需求中提到"绘制正方形、圆形、三角形"，但没有明确是 2D 平面还是 3D 立体。

**我的两种理解：**

#### 方案 A：2D 平面形状
- 正方形 = 平面四边形（ShapeGeometry）
- 圆形 = 平面圆（CircleGeometry）
- 三角形 = 平面三角形（ShapeGeometry）
- 所有形状平放在 XZ 平面上

#### 方案 B：3D 立体几何
- 正方形 = 立方体（BoxGeometry）
- 圆形 = 球体（SphereGeometry）
- 三角形 = 锥体（ConeGeometry）
- 3D 空间中的立体对象

**影响范围：**
- 渲染代码实现
- 几何数据存储格式
- 用户交互方式
- 视觉效果

**需要用户确认：**
- [ ] 使用方案 A（2D 平面）
- [ ] 使用方案 B（3D 立体）
- [ ] 其他方案

---

### 问题 2：几何数据存储格式

**当前设计：**
```json
{
  "square": {
    "sideLength": 5,
    "vertices": [[x1,y1,z1], [x2,y2,z2], [x3,y3,z3], [x4,y4,z4]]
  },
  "circle": {
    "radius": 10,
    "center": [x, y, z]
  },
  "triangle": {
    "vertices": [[x1,y1,z1], [x2,y2,z2], [x3,y3,z3]]
  }
}
```

**需要用户确认：**
- [ ] 这个格式是否符合预期？
- [ ] 是否需要调整？

---

## 二、已确认的设计方案 ✅

### 1. 技术栈
- ✅ 后端：Node.js + TypeScript + LangGraph + MySQL
- ✅ 前端：React + TypeScript + Three.js
- ✅ 部署：本地开发（不用 LangSmith）
- ✅ SDK：使用 LangGraph SDK

### 2. 数据库设计
- ✅ shapes 表（JSON 存储几何数据）
- ✅ shape_operations 表（支持 undo/redo）
- ✅ 表结构已最终确定

### 3. interrupt 机制
- ✅ 使用 `interrupt()` 函数触发
- ✅ 前端通过 `chunk.__interrupt__` 检测
- ✅ 使用 `command: {resume: {...}}` 恢复
- ✅ 本地开发完全支持

### 4. MVP 范围
- ✅ 第一阶段：实现"创建正方形"功能
- ✅ 不需要 interrupt（流程最简单）
- ✅ 快速验证整个架构

### 5. "上一个正方形"方案
- ✅ MVP 阶段：基于创建时间（数据库查询）
- ✅ 优化阶段：升级到引用栈

### 6. LangGraph 配置
- ✅ 使用 MemorySaver 作为 Checkpointer
- ✅ 通过 thread_id 管理会话
- ✅ 不需要额外的环境配置

### 7. AgentState 设计
- ✅ messages：对话历史（最多 20 条）
- ✅ tempData：临时数据（感知结果、操作目标）
- ✅ referencedObjects：引用栈（优化阶段添加）

### 8. Undo/Redo 机制
- ✅ 每次操作插入一条记录
- ✅ 通过 before_state 和 after_state 支持多步回退
- ✅ 不是只能维护一步回退状态

---

## 三、讨论进度总结

### 已完成的讨论：
1. ✅ 核心架构设计（HTTP + interrupt + checkpoint）
2. ✅ 数据流和通信机制
3. ✅ 状态管理和数据一致性
4. ✅ 工具实现位置（前端感知 + 后端操作）
5. ✅ LangGraph 架构设计（Supervisor + 子 Agent）
6. ✅ 数据库表结构设计
7. ✅ interrupt 机制理解（基于官方示例）
8. ✅ MVP 概念和范围确定
9. ✅ "上一个正方形"三个方案对比
10. ✅ AgentState 设计

### 待讨论的内容：
- ⚠️ Three.js 渲染方式（2D vs 3D）
- ⚠️ 几何数据存储格式确认
- 🔄 API 接口详细设计（在实现过程中完善）
- 🔄 前端 Three.js 具体实现细节（在实现过程中完善）

---

## 四、创建的文档清单

### 主文档：
1. `doc/设计讨论记录.md` - 最终结论汇总

### 讨论记录：
2. `doc/讨论记录-2-关于interrupt和undo机制.md`
3. `doc/讨论记录-3-interrupt示例分析和方案详解.md`
4. `doc/讨论记录-3-总结.md`
5. `doc/讨论记录-4-技术方案最终确认.md`
6. `doc/讨论记录-5-Three.js实现和State设计.md`
7. `doc/待确认问题清单.md`（本文件）

### 用户回答：
- `doc/我的回答.md`
- `doc/我的回答.2.md`
- `doc/我的回答.3.md`
- `doc/我的回答.5.md`
- `doc/我的回答.6.md`

### 参考资料：
- `doc/LanggraphSDK.md`
- `doc/interrupt/backend.ts`
- `doc/interrupt/frontend.tsx`

---

## 五、下次对话的起点

### 需要优先确认：
1. **Three.js 渲染方式**（2D 平面 vs 3D 立体）
2. **几何数据存储格式**

### 确认后可以开始：
1. 创建数据库表
2. 实现后端 LangGraph Agent
3. 实现前端基础框架
4. 实现 MVP（创建正方形）

---

## 六、关键技术决策表

| 问题 | 决策 | 状态 |
|------|------|------|
| 通信方式 | HTTP（不用 WebSocket） | ✅ 已确认 |
| 部署方式 | 本地开发（不用 LangSmith） | ✅ 已确认 |
| 数据源 | 数据库单一数据源 | ✅ 已确认 |
| ID 生成 | 后端生成 UUID | ✅ 已确认 |
| 感知工具 | 前端实现 | ✅ 已确认 |
| 操作工具 | 后端实现 | ✅ 已确认 |
| Agent 架构 | Supervisor + 子 Agent | ✅ 已确认 |
| 对象引用 | MVP 用创建时间 | ✅ 已确认 |
| 数据库设计 | 单表 + JSON + 历史表 | ✅ 已确认 |
| interrupt 机制 | 使用官方 interrupt() | ✅ 已确认 |
| MVP 范围 | 创建正方形 | ✅ 已确认 |
| **渲染方式** | **2D 平面 vs 3D 立体** | ⚠️ **待确认** |
| **数据格式** | **几何数据存储格式** | ⚠️ **待确认** |

---

## 七、备注

- 所有讨论记录都已保存在 `doc/` 目录
- 下次对话时可以参考这些文档快速恢复上下文
- API 接口设计采用迭代方式，在实现过程中不断完善
- 错误处理暂不考虑，假设所有流程都正常
