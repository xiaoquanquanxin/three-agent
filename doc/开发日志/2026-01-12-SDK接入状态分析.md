# å¼€å‘æ—¥å¿— - 2026-01-12

## ä¼šè¯ä¸»é¢˜ï¼šLangGraph SDK æ¥å…¥çŠ¶æ€åˆ†æ

### ä¸€ã€èƒŒæ™¯
ç”¨æˆ·è¯¢é—® SDK æ¥å…¥æƒ…å†µï¼Œä¸ç¡®å®šå‰ä¸€ä¸ª Claude æ˜¯å¦å®Œæˆäº†è¿™éƒ¨åˆ†å·¥ä½œã€‚

---

## äºŒã€SDK æ¥å…¥ç°çŠ¶æ€»ç»“

### âœ… å·²å®Œæˆçš„å·¥ä½œ

#### 1. SDK ä¾èµ–å®‰è£…
**æ–‡ä»¶**: `backend/package.json`
- âœ… `@langchain/langgraph-sdk`: ^1.5.2
- âœ… `@langchain/langgraph`: ^1.0.15
- âœ… `@langchain/langgraph-cli`: ^1.1.11

#### 2. LangGraph Server é…ç½®
**æ–‡ä»¶**: `backend/langgraph.json`
```json
{
  "dependencies": ["."],
  "graphs": {
    "agent": "./src/agents/workflow.ts:graph"
  },
  "env": "../.env"
}
```
- âœ… é…ç½®æ­£ç¡®æŒ‡å‘ workflow.ts:graph
- âœ… ç¯å¢ƒå˜é‡æŒ‡å‘æ ¹ç›®å½•çš„ .env

#### 3. Workflow Graph å¯¼å‡º
**æ–‡ä»¶**: `backend/src/agents/workflow.ts:104`
```typescript
export const graph = builder.compile({ checkpointer });
```
- âœ… æ­£ç¡®å¯¼å‡º graph ä¾› langgraph dev ä½¿ç”¨
- âœ… ä½¿ç”¨ MemorySaver ä½œä¸º checkpointer

#### 4. SDK Handler å®ç°
**æ–‡ä»¶**: `backend/src/api/handlers-sdk.ts`

å·²å®ç°ä¸¤ä¸ªå‡½æ•°ï¼š

##### handleChatSDK (L15-105)
- âœ… åˆ›å»º SDK Client è¿æ¥åˆ° `http://localhost:2024`
- âœ… ä½¿ç”¨ `client.runs.stream()` å‘èµ·æµå¼è°ƒç”¨
- âœ… æ£€æµ‹ interrupt äº‹ä»¶å¹¶è¿”å›ç»™å‰ç«¯
- âœ… æ­£å¸¸å®Œæˆæ—¶è¿”å›ç»“æœï¼ˆcreate/delete/modify/noneï¼‰

##### handleChatSDKContinue (L111-169)
- âœ… å¤„ç† interrupt åçš„ continue è¯·æ±‚
- âœ… Resume workflow æ‰§è¡Œ
- âœ… è¿”å›æœ€ç»ˆç»“æœ

#### 5. API è·¯ç”±é…ç½®
**æ–‡ä»¶**: `backend/src/api/routes.ts`
```typescript
router.post('/chat-sdk', handleChatSDK);           // æ–°ç‰ˆï¼šä½¿ç”¨ SDK
router.post('/chat-sdk/continue', handleChatSDKContinue);
router.post('/chat', handleChat);                  // æ—§ç‰ˆï¼šç›´æ¥ invoke
```
- âœ… æ–°æ—§ä¸¤ä¸ªç‰ˆæœ¬çš„ API éƒ½ä¿ç•™

---

## ä¸‰ã€ä¸¤ç§å®ç°æ–¹å¼å¯¹æ¯”

### æ–¹å¼ 1ï¼šç›´æ¥è°ƒç”¨ï¼ˆæ—§ç‰ˆï¼‰
**è·¯ç”±**: `POST /api/chat`
**æµç¨‹**:
```
å‰ç«¯ â†’ Express API â†’ workflow.invoke() â†’ è¿”å›ç»“æœ
```

**ç‰¹ç‚¹**:
- âœ… ç®€å•ç›´æ¥ï¼Œæ— éœ€é¢å¤–æœåŠ¡
- âœ… å·²æµ‹è¯•å¯ç”¨ï¼ˆMVP æµ‹è¯•é€šè¿‡ï¼‰
- âŒ ç¼ºå°‘ LangGraph Server çš„é«˜çº§ç‰¹æ€§
- âŒ ä¸æ”¯æŒ LangGraph Studio å¯è§†åŒ–è°ƒè¯•

### æ–¹å¼ 2ï¼šSDK è°ƒç”¨ï¼ˆæ–°ç‰ˆï¼‰
**è·¯ç”±**: `POST /api/chat-sdk`
**æµç¨‹**:
```
å‰ç«¯ â†’ Express API â†’ SDK Client â†’ LangGraph Server (localhost:2024) â†’ workflow â†’ è¿”å›ç»“æœ
```

**ç‰¹ç‚¹**:
- âœ… æ”¯æŒ LangGraph çš„å®Œæ•´ç”Ÿæ€
- âœ… å¯ä»¥ä½¿ç”¨ LangGraph Studio è°ƒè¯•
- âœ… æ›´å¥½çš„æµå¼å¤„ç†å’Œ interrupt æ”¯æŒ
- âœ… ç¬¦åˆç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ
- âŒ éœ€è¦é¢å¤–å¯åŠ¨ langgraph dev æœåŠ¡
- â“ å°šæœªæµ‹è¯•æ˜¯å¦å¯ç”¨

---

## å››ã€SDK æ–¹å¼çš„æ¶æ„

### æœåŠ¡æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend  â”‚
â”‚  (5174)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ HTTP
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Express   â”‚
â”‚   (8888)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ SDK Client
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LangGraph   â”‚
â”‚   Server    â”‚
â”‚   (2024)    â”‚ â† langgraph dev
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Workflow   â”‚
â”‚  (graph)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®é…ç½®

#### LangGraph Server å¯åŠ¨å‘½ä»¤
```bash
cd backend
npx langgraph dev
```
- é»˜è®¤ç«¯å£ï¼š2024
- è¯»å–ï¼š`langgraph.json`
- åŠ è½½ï¼š`workflow.ts:graph`

#### SDK Client é…ç½®
```typescript
const client = new Client({ apiUrl: 'http://localhost:2024' });
const ASSISTANT_ID = 'agent';  // å¯¹åº” langgraph.json ä¸­çš„ "agent"
```

---

## äº”ã€SDK æ–¹å¼çš„å·¥ä½œæµç¨‹

### åœºæ™¯ 1ï¼šæ—  interruptï¼ˆç®€å•åˆ›å»ºï¼‰

```typescript
// å‰ç«¯è¯·æ±‚
POST /api/chat-sdk
{
  "message": "ç”»ä¸€ä¸ªæ­£æ–¹å½¢ï¼Œè¾¹é•¿5",
  "sessionId": "...",
  "threadId": "..."
}

// SDK è°ƒç”¨æµç¨‹
1. client.runs.stream(threadId, "agent", { input: {...} })
2. æ¥æ”¶ chunk.event === "values"ï¼ˆçŠ¶æ€æ›´æ–°ï¼‰
3. workflow æ‰§è¡Œå®Œæˆ
4. è¿”å›ç»“æœï¼š
{
  "status": "completed",
  "action": "create",
  "data": { id: "...", type: "square", ... },
  "threadId": "...",
  "sessionId": "..."
}
```

### åœºæ™¯ 2ï¼šæœ‰ interruptï¼ˆéœ€è¦å‰ç«¯å·¥å…·ï¼‰

```typescript
// å‰ç«¯è¯·æ±‚
POST /api/chat-sdk
{ "message": "åœ¨åæ ‡ (10,0,10) é™„è¿‘ç”»æ­£æ–¹å½¢" }

// SDK è°ƒç”¨æµç¨‹
1. client.runs.stream(...)
2. CreateAgent è§¦å‘ interrupt()
3. æ¥æ”¶ chunk.event === "interrupt"
4. è¿”å›ç»™å‰ç«¯ï¼š
{
  "status": "interrupted",
  "action": "getNearbyObjects",
  "params": { x: 10, y: 0, z: 10, radius: 5 },
  "threadId": "..."
}

// å‰ç«¯æ‰§è¡Œå·¥å…·ï¼Œç„¶å continue
POST /api/chat-sdk/continue
{
  "threadId": "...",
  "toolResult": { nearbyObjects: [...] }
}

// SDK Resume
1. client.runs.stream(threadId, "agent", { input: toolResult })
2. workflow ç»§ç»­æ‰§è¡Œ
3. è¿”å›æœ€ç»ˆç»“æœ
```

---

## å…­ã€å½“å‰çŠ¶æ€è¯„ä¼°

### ä»£ç å®Œæˆåº¦ï¼š95%
- âœ… æ‰€æœ‰å¿…éœ€çš„ä»£ç éƒ½å·²å®ç°
- âœ… SDK Client é…ç½®æ­£ç¡®
- âœ… langgraph.json é…ç½®æ­£ç¡®
- âœ… workflow.ts å¯¼å‡ºæ­£ç¡®
- âœ… handlers-sdk.ts é€»è¾‘å®Œæ•´

### ç¼ºå¤±éƒ¨åˆ†ï¼š5%
- â“ **æœªæµ‹è¯•**ï¼šSDK æ–¹å¼æ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œ
- â“ **å‰ç«¯æœªæ›´æ–°**ï¼šå‰ç«¯ç›®å‰è¿˜åœ¨ä½¿ç”¨ `/api/chat`ï¼ˆæ—§ç‰ˆï¼‰
- â“ **æ–‡æ¡£ç¼ºå¤±**ï¼šç¼ºå°‘ SDK æ–¹å¼çš„ä½¿ç”¨è¯´æ˜

---

## ä¸ƒã€ä¸‹ä¸€æ­¥è¡ŒåŠ¨è®¡åˆ’

### é€‰é¡¹ 1ï¼šæµ‹è¯• SDK æ–¹å¼ï¼ˆæ¨èï¼‰

**æ­¥éª¤**:
1. å¯åŠ¨ LangGraph Server
   ```bash
   cd backend
   npx langgraph dev
   ```
   é¢„æœŸè¾“å‡ºï¼š
   ```
   - ğŸš€ API: http://localhost:2024
   - ğŸ¨ Studio UI: http://localhost:2024/studio
   - ğŸ“Š Graphs: agent
   ```

2. æµ‹è¯• SDK APIï¼ˆä¿æŒ Express è¿è¡Œï¼‰
   ```bash
   # æµ‹è¯•ç®€å•åˆ›å»ºï¼ˆæ—  interruptï¼‰
   curl -X POST http://localhost:8888/api/chat-sdk \
     -H "Content-Type: application/json" \
     -d '{"message": "ç”»ä¸€ä¸ªæ­£æ–¹å½¢ï¼Œè¾¹é•¿5"}'
   ```

3. æ£€æŸ¥å“åº”
   - é¢„æœŸï¼š`{ "status": "completed", "action": "create", ... }`
   - å¦‚æœå¤±è´¥ï¼šæŸ¥çœ‹åç«¯æ—¥å¿—å’Œ langgraph dev æ—¥å¿—

### é€‰é¡¹ 2ï¼šæ›´æ–°å‰ç«¯ä½¿ç”¨ SDK æ–¹å¼

**éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶**:
- `frontend/src/App.tsx`ï¼šå°† `/api/chat` æ”¹ä¸º `/api/chat-sdk`
- æ·»åŠ  interrupt å¤„ç†é€»è¾‘ï¼ˆæ£€æµ‹ `status === "interrupted"`ï¼‰
- å®ç°å‰ç«¯å·¥å…·è°ƒç”¨å’Œ continue è¯·æ±‚

### é€‰é¡¹ 3ï¼šç»§ç»­ä½¿ç”¨æ—§ç‰ˆæ–¹å¼

**ç†ç”±**:
- æ—§ç‰ˆæ–¹å¼å·²æµ‹è¯•å¯ç”¨
- æ›´ç®€å•ï¼Œæ— éœ€é¢å¤–æœåŠ¡
- é€‚åˆ MVP å¿«é€Ÿè¿­ä»£

**ç¼ºç‚¹**:
- æ— æ³•ä½¿ç”¨ LangGraph Studio è°ƒè¯•
- ç”Ÿäº§ç¯å¢ƒä¸æ¨è

---

## å…«ã€å…³é”®æ–‡ä»¶æ¸…å•

### å·²å®ç°çš„ SDK ç›¸å…³æ–‡ä»¶
1. `backend/langgraph.json` - LangGraph Server é…ç½®
2. `backend/src/agents/workflow.ts:104` - Graph å¯¼å‡º
3. `backend/src/api/handlers-sdk.ts` - SDK Handler å®ç°
4. `backend/src/api/routes.ts` - SDK è·¯ç”±é…ç½®

### æ–‡æ¡£è®°å½•
5. `doc/sdk/é—®é¢˜.md` - SDK ç›¸å…³é—®é¢˜è®¨è®º
6. `backend/npm.md` - ä¾èµ–å®‰è£…æ¸…å•
7. `doc/å¼€å‘æ—¥å¿—/2026-01-12-SDKæ¥å…¥çŠ¶æ€åˆ†æ.md` - æœ¬æ–‡ä»¶

---

## ä¹ã€æŠ€æœ¯è¦ç‚¹

### 1. LangGraph Server vs ç›´æ¥è°ƒç”¨

| ç‰¹æ€§ | ç›´æ¥è°ƒç”¨ | LangGraph Server |
|------|----------|------------------|
| å¯åŠ¨æ–¹å¼ | workflow.invoke() | langgraph dev |
| è°ƒç”¨æ–¹å¼ | ç›´æ¥è°ƒç”¨å‡½æ•° | SDK Client â†’ HTTP API |
| Checkpointer | MemorySaver | MemorySaverï¼ˆå¯å‡çº§ä¸º Postgresï¼‰ |
| è°ƒè¯•å·¥å…· | æ—  | LangGraph Studio |
| ç”Ÿäº§éƒ¨ç½² | Express + workflow | ç‹¬ç«‹ Server + Postgres |
| å¤æ‚åº¦ | ä½ | ä¸­ |

### 2. SDK Client æ ¸å¿ƒ API

```typescript
// æµå¼æ‰§è¡Œï¼ˆæ”¯æŒ interruptï¼‰
const stream = client.runs.stream(threadId, assistantId, {
  input: { messages: [...] },
  streamMode: 'values',
});

for await (const chunk of stream) {
  if (chunk.event === 'values') {
    // çŠ¶æ€æ›´æ–°
  }
  if (chunk.event === 'interrupt') {
    // æ£€æµ‹åˆ° interrupt
    break;
  }
}
```

### 3. Interrupt æ•°æ®æ ¼å¼

```typescript
// interrupt æ—¶è¿”å›çš„æ•°æ®
{
  status: 'interrupted',
  action: 'getNearbyObjects',
  params: { x: 10, y: 0, z: 10, radius: 5 },
  threadId: '...'
}

// Continue æ—¶å‘é€çš„æ•°æ®
{
  threadId: '...',
  toolResult: {
    nearbyObjects: [
      { id: 'square_001', type: 'square', distance: 2.3 }
    ]
  }
}
```

---

## åã€å»ºè®®

### ç»™ç”¨æˆ·çš„å»ºè®®

1. **å¦‚æœä½ æƒ³å¿«é€Ÿç»§ç»­å¼€å‘**ï¼š
   - ç»§ç»­ä½¿ç”¨æ—§ç‰ˆ `/api/chat`
   - SDK æ–¹å¼å·²ç»å®ç°ï¼Œå¯ä»¥åç»­å†æµ‹è¯•

2. **å¦‚æœä½ æƒ³ä½¿ç”¨ LangGraph Studio è°ƒè¯•**ï¼š
   - æµ‹è¯• SDK æ–¹å¼ï¼ˆæŒ‰é€‰é¡¹ 1 çš„æ­¥éª¤ï¼‰
   - è¿™æ˜¯æ¨èçš„æ–¹å¼ï¼Œæ›´ç¬¦åˆç”Ÿäº§ç¯å¢ƒ

3. **å¦‚æœä½ æƒ³å®Œæ•´çš„ interrupt æ”¯æŒ**ï¼š
   - éœ€è¦ä½¿ç”¨ SDK æ–¹å¼
   - æ—§ç‰ˆæ–¹å¼çš„ interrupt æ”¯æŒæœ‰é™

### å¼€å‘ä¼˜å…ˆçº§

**é«˜ä¼˜å…ˆçº§**ï¼ˆæ¨èå…ˆåšï¼‰ï¼š
- æµ‹è¯• SDK æ–¹å¼æ˜¯å¦å¯ç”¨
- ç¡®è®¤ langgraph dev èƒ½å¦æ­£å¸¸å¯åŠ¨

**ä¸­ä¼˜å…ˆçº§**ï¼š
- æ›´æ–°å‰ç«¯ä½¿ç”¨ SDK æ–¹å¼
- å®ç°å®Œæ•´çš„ interrupt æµç¨‹

**ä½ä¼˜å…ˆçº§**ï¼š
- ä¼˜åŒ–é”™è¯¯å¤„ç†
- æ·»åŠ æ—¥å¿—å’Œç›‘æ§

---

## åä¸€ã€é—®é¢˜è¿½è¸ª

### å·²çŸ¥é—®é¢˜
- â“ SDK æ–¹å¼æœªç»è¿‡æµ‹è¯•
- â“ å‰ç«¯å°šæœªé€‚é… SDK æ–¹å¼

### æ½œåœ¨é£é™©
- âš ï¸ langgraph dev å¯èƒ½éœ€è¦é¢å¤–é…ç½®
- âš ï¸ SDK Client è¿æ¥å¯èƒ½å¤±è´¥ï¼ˆç«¯å£å†²çªç­‰ï¼‰

---

**è®°å½•æ—¶é—´**ï¼š2026-01-12 19:30
**è®°å½•è€…**ï¼šClaude Code
**ä¼šè¯çŠ¶æ€**ï¼šSDK ä»£ç å·²å®ç°å®Œæ¯•ï¼Œç­‰å¾…æµ‹è¯•éªŒè¯
