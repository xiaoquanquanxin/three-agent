# 待确认问题清单

> 最后更新：2026-01-12
> 状态：所有核心问题已确认 ✅

---

## 一、核心疑问（已全部确认 ✅）

### 问题 1：Three.js 渲染方式 ✅（已确认）

**用户确认（2026-01-12）：**
- ✅ 相机要 3D（可以旋转、缩放视角）
- ✅ 渲染的图形可以是 2D（平面形状）

**实现方案：**
- 使用 Three.js 的 3D 相机（PerspectiveCamera + OrbitControls）
- 正方形 = 平面四边形（ShapeGeometry）
- 圆形 = 平面圆（CircleGeometry）
- 三角形 = 平面三角形（ShapeGeometry）
- 所有形状平放在 XZ 平面上

---

### 问题 2：几何数据存储格式 ✅（已确认）

**用户确认（2026-01-12）：**
- ✅ 用一个额外的字段 `vertexList` 存储顶点的 JSON

**最终格式：**
```json
{
  "id": "square_001",
  "type": "square",
  "vertexList": [
    [7.5, 0, 7.5],
    [12.5, 0, 7.5],
    [12.5, 0, 12.5],
    [7.5, 0, 12.5]
  ],
  "position_x": 10,
  "position_y": 0,
  "position_z": 10
}
```

---

## 二、已确认的设计方案 ✅

### 1. 技术栈
- ✅ 后端：Node.js + TypeScript + LangGraph + MySQL
- ✅ 前端：React + TypeScript + Three.js
- ✅ 部署：本地开发（不用 LangSmith）
- ✅ SDK：使用 LangGraph SDK

### 2. 数据库设计
- ✅ shapes 表（JSON 存储几何数据）
- ✅ shape_operations 表（支持 undo/redo）
- ✅ 表结构已最终确定

### 3. interrupt 机制
- ✅ 使用 `interrupt()` 函数触发
- ✅ 前端通过 `chunk.__interrupt__` 检测
- ✅ 使用 `command: {resume: {...}}` 恢复
- ✅ 本地开发完全支持

### 4. MVP 范围
- ✅ 第一阶段：实现"创建正方形"功能
- ✅ 不需要 interrupt（流程最简单）
- ✅ 快速验证整个架构

### 5. "上一个正方形"方案
- ✅ MVP 阶段：基于创建时间（数据库查询）
- ✅ 优化阶段：升级到引用栈

### 6. LangGraph 配置
- ✅ 使用 MemorySaver 作为 Checkpointer
- ✅ 通过 thread_id 管理会话
- ✅ 不需要额外的环境配置

### 7. AgentState 设计
- ✅ messages：对话历史（最多 20 条）
- ✅ tempData：临时数据（感知结果、操作目标）
- ✅ referencedObjects：引用栈（优化阶段添加）

### 8. Undo/Redo 机制
- ✅ 每次操作插入一条记录
- ✅ 通过 before_state 和 after_state 支持多步回退
- ✅ 不是只能维护一步回退状态

### 9. Three.js 渲染方式（2026-01-12 确认）
- ✅ 相机使用 3D（PerspectiveCamera + OrbitControls）
- ✅ 图形渲染为 2D 平面
- ✅ 正方形：ShapeGeometry
- ✅ 圆形：CircleGeometry
- ✅ 三角形：ShapeGeometry
- ✅ 所有形状平放在 XZ 平面上

### 10. 几何数据存储格式（2026-01-12 确认）
- ✅ 使用 `vertexList` 字段存储顶点 JSON
- ✅ 正方形：4 个顶点
- ✅ 三角形：3 个顶点
- ✅ 圆形：存储中心点和半径或圆周采样点

---

## 三、讨论进度总结

### 已完成的讨论：
1. ✅ 核心架构设计（HTTP + interrupt + checkpoint）
2. ✅ 数据流和通信机制
3. ✅ 状态管理和数据一致性
4. ✅ 工具实现位置（前端感知 + 后端操作）
5. ✅ LangGraph 架构设计（Supervisor + 子 Agent）
6. ✅ 数据库表结构设计
7. ✅ interrupt 机制理解（基于官方示例）
8. ✅ MVP 概念和范围确定
9. ✅ "上一个正方形"三个方案对比
10. ✅ AgentState 设计
11. ✅ Three.js 渲染方式确认（2026-01-12）
12. ✅ 几何数据存储格式确认（2026-01-12）

### 待讨论的内容：
- 🔄 API 接口详细设计（在实现过程中完善）
- 🔄 前端 Three.js 具体实现细节（在实现过程中完善）

---

## 四、创建的文档清单

### 主文档：
1. `doc/设计讨论记录.md` - 最终结论汇总

### 讨论记录：
2. `doc/讨论记录-2-关于interrupt和undo机制.md`
3. `doc/讨论记录-3-interrupt示例分析和方案详解.md`
4. `doc/讨论记录-3-总结.md`
5. `doc/讨论记录-4-技术方案最终确认.md`
6. `doc/讨论记录-5-Three.js实现和State设计.md`
7. `doc/待确认问题清单.md`（本文件）

### 用户回答：
- `doc/我的回答.1.md`
- `doc/我的回答.2.md`
- `doc/我的回答.3.md`
- `doc/我的回答.4.md`
- `doc/我的回答.5.md`
- `doc/我的回答.6.md`
- `doc/我的回答.7.md`（2026-01-12）

### 参考资料：
- `doc/LanggraphSDK.md`
- `doc/interrupt/backend.ts`
- `doc/interrupt/frontend.tsx`

---

## 五、下次对话的起点

### 所有核心问题已确认 ✅

所有关键技术决策已经明确，可以开始实现 MVP：
1. 创建数据库表
2. 实现后端 LangGraph Agent
3. 实现前端基础框架
4. 实现 MVP（创建正方形）

---

## 六、关键技术决策表

| 问题 | 决策 | 状态 |
|------|------|------|
| 通信方式 | HTTP（不用 WebSocket） | ✅ 已确认 |
| 部署方式 | 本地开发（不用 LangSmith） | ✅ 已确认 |
| 数据源 | 数据库单一数据源 | ✅ 已确认 |
| ID 生成 | 后端生成 UUID | ✅ 已确认 |
| 感知工具 | 前端实现 | ✅ 已确认 |
| 操作工具 | 后端实现 | ✅ 已确认 |
| Agent 架构 | Supervisor + 子 Agent | ✅ 已确认 |
| 对象引用 | MVP 用创建时间 | ✅ 已确认 |
| 数据库设计 | 单表 + JSON + 历史表 | ✅ 已确认 |
| interrupt 机制 | 使用官方 interrupt() | ✅ 已确认 |
| MVP 范围 | 创建正方形 | ✅ 已确认 |
| **渲染方式** | **3D 相机 + 2D 平面图形** | ✅ **已确认（2026-01-12）** |
| **数据格式** | **vertexList 字段存 JSON** | ✅ **已确认（2026-01-12）** |

---

## 七、备注

- 所有讨论记录都已保存在 `doc/` 目录
- 下次对话时可以参考这些文档快速恢复上下文
- API 接口设计采用迭代方式，在实现过程中不断完善
- 错误处理暂不考虑，假设所有流程都正常
