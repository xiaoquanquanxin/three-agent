# 讨论记录 #4 - 技术方案最终确认

> 时间：2026-01-09
> 主题：部署方式、MVP 范围、数据库结构最终确认

---

## 一、关键技术决策

### 1. 部署方式 ✅

**确认：**
- ✅ **本地开发**（不用 LangSmith）
- ✅ **本地完全支持 interrupt 机制**
- ✅ **使用 LangGraph SDK**（最好有）

**理解：**
虽然官方示例提到了 LangSmith 部署，但代码中的 interrupt 机制在本地开发环境中同样可用。

---

### 2. MVP 功能范围 ✅

**确认：**
- ✅ 先实现**创建正方形**功能
- ✅ 能实现多少就实现多少

**MVP 第一阶段目标：**
```
用户输入："画一个正方形，边长5"
  ↓
后端 LangGraph 解析意图
  ↓
CreateAgent 创建数据（插入数据库）
  ↓
返回给前端：{"action": "create", "data": {...}}
  ↓
前端 Three.js 渲染正方形
  ↓
完成
```

**特点：**
- 不需要 interrupt（流程最简单）
- 可以快速验证整个架构
- 为后续功能打基础

---

### 3. 数据库表结构 ✅

**确认：**
- ✅ 使用提供的表结构
- ✅ JSON 存储几何数据

**最终表结构：**

#### 主表：shapes
```sql
CREATE TABLE shapes (
  id VARCHAR(36) PRIMARY KEY,
  type ENUM('square', 'circle', 'triangle') NOT NULL,
  geometry JSON NOT NULL,
  position_x FLOAT NOT NULL,
  position_y FLOAT NOT NULL,
  position_z FLOAT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  INDEX idx_type (type),
  INDEX idx_created (created_at DESC)
);
```

#### 操作历史表：shape_operations
```sql
CREATE TABLE shape_operations (
  id INT AUTO_INCREMENT PRIMARY KEY,
  session_id VARCHAR(36) NOT NULL,
  shape_id VARCHAR(36),
  operation ENUM('create', 'update', 'delete') NOT NULL,
  before_state JSON,
  after_state JSON,
  operated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  INDEX idx_session (session_id, operated_at DESC)
);
```
